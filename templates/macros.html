{% macro kpi_card(icon, label, value, color='primary', secondary_value=None) %}
<div class="card border-0 shadow-sm h-100 kpi-card">
    <div class="card-body p-3">
        <div class="d-flex align-items-center">
            <div class="me-3 text-{{ color }}">
                <i class="bi bi-{{ icon }} fs-3"></i>
            </div>
            <div class="flex-grow-1">
                <div class="text-muted small">{{ label }}</div>
                <div class="h4 mb-0 fw-bold">
                    {{ value }}
                    {% if secondary_value %}
                    <small class="text-muted fs-6">{{ secondary_value }}</small>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style nonce="{{ csp_nonce() }}">
.kpi-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    cursor: default;
}

.kpi-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
}
</style>
{% endmacro %}

{% macro status_badge(status) %}
{% if status == 'Draft' or status == 0 %}
    <span class="badge bg-secondary">Draft</span>
{% elif status == 'Submitted' or status == 1 %}
    <span class="badge bg-primary">Submitted</span>
{% elif status == 'Fulfilment Prepared' or status == 2 %}
    <span class="badge bg-info">Fulfilment Prepared</span>
{% elif status == 'Awaiting Approval' or status == 3 %}
    <span class="badge bg-warning text-dark">Awaiting Approval</span>
{% elif status == 'Approved' or status == 4 %}
    <span class="badge bg-success">Approved</span>
{% elif status == 'In Preparation' %}
    <span class="badge bg-info">In Preparation</span>
{% elif status == 'Ready' %}
    <span class="badge bg-primary">Ready</span>
{% elif status == 'Dispatched' or status == 5 %}
    <span class="badge bg-success"><i class="bi bi-truck"></i> Dispatched</span>
{% elif status == 'Received' or status == 6 %}
    <span class="badge bg-dark">Received</span>
{% elif status == 'Completed' or status == 7 %}
    <span class="badge bg-success"><i class="bi bi-check-circle"></i> Completed</span>
{% elif status == 'P' %}
    <span class="badge bg-warning text-dark">Pending</span>
{% elif status == 'C' %}
    <span class="badge bg-success">Completed</span>
{% elif status == 'A' %}
    <span class="badge bg-success">Active</span>
{% elif status == 'I' %}
    <span class="badge bg-secondary">Inactive</span>
{% else %}
    <span class="badge bg-secondary">{{ status }}</span>
{% endif %}
{% endmacro %}

{% macro data_table(headers, rows, actions=False) %}
<div class="table-responsive">
    <table class="table table-hover table-sm mb-0">
        <thead class="bg-light">
            <tr>
                {% for header in headers %}
                <th class="py-2 px-3">{{ header }}</th>
                {% endfor %}
                {% if actions %}
                <th class="py-2 px-3 text-end">Actions</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {{ caller() }}
        </tbody>
    </table>
</div>
{% endmacro %}
